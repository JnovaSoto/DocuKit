<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tools/fuzzySearch.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tools/fuzzySearch.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { API, ROUTES } from '../config/constants.js';
import { changePage } from '../navigation.js';

let fuse;
const overlay = document.getElementById('search-overlay');
const input = document.getElementById('command-k-input');
const resultsContainer = document.getElementById('search-results');

/**
 * Initialize the fuzzy search indexing.
 * Fetches all tags and properties and creates a Fuse instance.
 */
async function initSearch() {
    try {
        const [tagsRes, propsRes, attrsRes, propAttrsRes] = await Promise.all([
            fetch(API.TAGS.BASE),
            fetch(API.PROPERTIES.BASE),
            fetch(API.ATTRIBUTES.BASE),
            fetch(API.PROPERTY_ATTRIBUTES.BASE)
        ]);

        const tags = await tagsRes.json();
        const properties = await propsRes.json();
        const attributes = await attrsRes.json();
        const propAttributes = await propAttrsRes.json();

        // Map tags to their attributes
        const data = [
            ...tags.map(t => ({
                name: t.tagName,
                type: 'tag',
                id: t.id,
                attributes: attributes.filter(a => a.tagId === t.id).map(a => a.attribute)
            })),
            ...properties.map(p => ({
                name: p.propertyName,
                type: 'property',
                id: p.id,
                attributes: propAttributes.filter(a => a.propertyId === p.id).map(a => a.attribute)
            }))
        ];

        fuse = new Fuse(data, {
            keys: ['name', 'attributes'],
            threshold: 0.3,
            location: 0,
            distance: 100,
            minMatchCharLength: 1
        });

    } catch (err) {
        console.error('Failed to initialize search index:', err);
    }
}

/**
 * Event listener for Command+K or Ctrl+K.
 */
window.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) &amp;&amp; e.key === 'k') {
        e.preventDefault();
        toggleOverlay();
    }
    if (e.key === 'Escape' &amp;&amp; overlay.classList.contains('active')) {
        toggleOverlay();
    }
});

let selectedIndex = -1;

function toggleOverlay() {
    overlay.classList.toggle('active');
    if (overlay.classList.contains('active')) {
        input.focus();
        selectedIndex = -1;
        if (!fuse) initSearch();
    }
}

// Close when clicking outside the modal
overlay.addEventListener('click', (e) => {
    if (e.target === overlay) toggleOverlay();
});

// Search on input
input.addEventListener('input', () => {
    const query = input.value.trim();
    if (!query || !fuse) {
        resultsContainer.innerHTML = '';
        selectedIndex = -1;
        return;
    }

    const results = fuse.search(query).slice(0, 10);
    selectedIndex = -1;
    renderResults(results);
});

// Keyboard navigation for results
input.addEventListener('keydown', (e) => {
    const items = resultsContainer.querySelectorAll('.search-result-item');

    if (e.key === 'ArrowDown') {
        e.preventDefault();
        selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
        updateSelection(items);
    } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        selectedIndex = Math.max(selectedIndex - 1, -1);
        updateSelection(items);
    } else if (e.key === 'Enter') {
        e.preventDefault();
        if (selectedIndex >= 0) {
            items[selectedIndex].click();
        }
    }
});

function updateSelection(items) {
    items.forEach((item, idx) => {
        item.classList.toggle('selected', idx === selectedIndex);
        if (idx === selectedIndex) {
            item.scrollIntoView({ block: 'nearest' });
        }
    });
}

function renderResults(results) {
    resultsContainer.innerHTML = results.map((res, index) => `
        &lt;div class="search-result-item" data-type="${res.item.type}" data-name="${res.item.name}" data-id="${res.item.id}">
            &lt;div class="result-content">
                &lt;span class="result-name">${res.item.name}&lt;/span>
                &lt;span class="result-type">${res.item.type}&lt;/span>
            &lt;/div>
            ${res.item.attributes &amp;&amp; res.item.attributes.length > 0 ? `&lt;div class="result-attributes">${res.item.attributes.slice(0, 3).join(', ')}&lt;/div>` : ''}
        &lt;/div>
    `).join('');

    // Add click listeners to results
    resultsContainer.querySelectorAll('.search-result-item').forEach(item => {
        item.addEventListener('click', () => {
            const type = item.dataset.type;
            const name = item.dataset.name;

            toggleOverlay();
            input.value = '';
            resultsContainer.innerHTML = '';

            if (type === 'tag') {
                sessionStorage.setItem('lastTag', name);
                changePage(ROUTES.HOME);
            } else {
                sessionStorage.setItem('lastProperty', name);
                changePage(ROUTES.CSS);
            }
        });
    });
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ALERT_IDS">ALERT_IDS</a></li><li><a href="global.html#ALERT_TIMING">ALERT_TIMING</a></li><li><a href="global.html#API">API</a></li><li><a href="global.html#ERROR_MESSAGES">ERROR_MESSAGES</a></li><li><a href="global.html#HTTP_STATUS">HTTP_STATUS</a></li><li><a href="global.html#LOG_LEVELS">LOG_LEVELS</a></li><li><a href="global.html#ROUTES">ROUTES</a></li><li><a href="global.html#SESSION">SESSION</a></li><li><a href="global.html#SUCCESS_MESSAGES">SUCCESS_MESSAGES</a></li><li><a href="global.html#VALIDATION">VALIDATION</a></li><li><a href="global.html#addFavorite">addFavorite</a></li><li><a href="global.html#alert">alert</a></li><li><a href="global.html#applyTheme">applyTheme</a></li><li><a href="global.html#auth">auth</a></li><li><a href="global.html#checkSession">checkSession</a></li><li><a href="global.html#create">create</a></li><li><a href="global.html#darkThemes">darkThemes</a></li><li><a href="global.html#debug">debug</a></li><li><a href="global.html#deleteLog">deleteLog</a></li><li><a href="global.html#displayAttributeMetadata">displayAttributeMetadata</a></li><li><a href="global.html#edit">edit</a></li><li><a href="global.html#error">error</a></li><li><a href="global.html#executePageScript">executePageScript</a></li><li><a href="global.html#form">form</a></li><li><a href="global.html#generateAttributeBlock">generateAttributeBlock</a></li><li><a href="global.html#generateTable">generateTable</a></li><li><a href="global.html#getCurrentTheme">getCurrentTheme</a></li><li><a href="global.html#getCurrentUser">getCurrentUser</a></li><li><a href="global.html#getDarkMode">getDarkMode</a></li><li><a href="global.html#handlePopState">handlePopState</a></li><li><a href="global.html#handleResponseError">handleResponseError</a></li><li><a href="global.html#info">info</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initNavigation">initNavigation</a></li><li><a href="global.html#initSearch">initSearch</a></li><li><a href="global.html#initTheme">initTheme</a></li><li><a href="global.html#isDevelopment">isDevelopment</a></li><li><a href="global.html#lightThemes">lightThemes</a></li><li><a href="global.html#loadCssFavorites">loadCssFavorites</a></li><li><a href="global.html#loadEditForm">loadEditForm</a></li><li><a href="global.html#loadHeaderAndFooter">loadHeaderAndFooter</a></li><li><a href="global.html#loadTagFavorites">loadTagFavorites</a></li><li><a href="global.html#navigation">navigation</a></li><li><a href="global.html#network">network</a></li><li><a href="global.html#reloadHeader">reloadHeader</a></li><li><a href="global.html#removeFavorite">removeFavorite</a></li><li><a href="global.html#renderTable">renderTable</a></li><li><a href="global.html#requireAdmin">requireAdmin</a></li><li><a href="global.html#requireLogin">requireLogin</a></li><li><a href="global.html#resetInit">resetInit</a></li><li><a href="global.html#setupDarkModeToggle">setupDarkModeToggle</a></li><li><a href="global.html#setupSubmitHandler">setupSubmitHandler</a></li><li><a href="global.html#setupThemeSwitcher">setupThemeSwitcher</a></li><li><a href="global.html#showSkeleton">showSkeleton</a></li><li><a href="global.html#showTemporaryAlert">showTemporaryAlert</a></li><li><a href="global.html#success">success</a></li><li><a href="global.html#tag">tag</a></li><li><a href="global.html#toggleDarkMode">toggleDarkMode</a></li><li><a href="global.html#toggleTheme">toggleTheme</a></li><li><a href="global.html#user">user</a></li><li><a href="global.html#warn">warn</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Tue Dec 30 2025 11:37:52 GMT+0100 (hora est√°ndar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
